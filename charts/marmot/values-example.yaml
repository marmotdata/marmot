# Example Marmot values with all configuration options
# This file demonstrates all available configuration options

replicaCount: 2

image:
  repository: ghcr.io/marmotdata/marmot
  pullPolicy: IfNotPresent
  tag: "latest"

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: marmot.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: marmot-tls
      hosts:
        - marmot.example.com

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 200m
    memory: 256Mi

config:
  server:
    port: 8080
    host: "0.0.0.0"
    rootUrl: "https://marmot.example.com"
    customResponseHeaders:
      X-Frame-Options: "DENY"
      X-Content-Type-Options: "nosniff"

    # Encryption configuration - choose ONE option:

    # Option 1: Auto-generate (good for most deployments)
    # autoGenerateEncryptionKey: true

    # Option 2: Use your own key via secret (recommended for production)
    autoGenerateEncryptionKey: false
    encryptionKeySecretRef:
      name: "marmot-encryption-secret"
      key: "encryption-key"

    # Option 3: Disable encryption (NOT RECOMMENDED - dev/test only)
    # autoGenerateEncryptionKey: false
    # allowUnencrypted: true

  metrics:
    enabled: true
    port: 9090
    ownerMetadataFields:
      - "owner"
      - "ownedBy"
      - "owningTeam"
      - "squad"
    schemas:
      excludedAssetTypes:
        - "Service"
        - "Dashboard"
      excludedProviders:
        - "test-provider"

  database:
    host: "postgres.example.com"
    port: 5432
    user: "marmot"
    # Store password in a secret for production
    passwordSecretRef:
      name: "marmot-database-secret"
      key: "password"
    name: "marmot"
    sslmode: "require"
    maxConns: 50
    idleConns: 10
    connLifetime: 10

  logging:
    level: "info"
    format: "json"

  auth:
    anonymous:
      enabled: false
      role: "viewer"

    openlineage:
      enabled: true

    providers:
      okta:
        enabled: true
        type: "okta"
        name: "Okta SSO"
        clientId: "your-okta-client-id"
        # Store client secret in a secret for production
        clientSecretRef:
          name: "okta-secret"
          key: "client-secret"
        url: "https://your-org.okta.com"
        redirectUrl: "https://marmot.example.com/api/v1/auth/callback/okta"
        scopes:
          - "openid"
          - "profile"
          - "email"
          - "groups"
          - "offline_access"
        allowSignup: true
        groupMapping:
          - groupName: "marmot-admins"
            roles:
              - "admin"
          - groupName: "marmot-users"
            roles:
              - "user"
        teamSync:
          enabled: true
          stripPrefix: "marmot-team-"
          group:
            claim: "groups"
            filter:
              mode: "prefix"
              pattern: "marmot-team-"

  rateLimit:
    enabled: true

  ui:
    banner:
      enabled: true
      dismissible: true
      variant: "info"
      message: "Welcome to Marmot! This is a demo environment."
      id: "welcome-banner"

  pipelines:
    maxWorkers: 20
    schedulerInterval: 30
    leaseExpiry: 600
    claimExpiry: 60

monitoring:
  serviceMonitor:
    enabled: true
    labels:
      prometheus: kube-prometheus
    interval: 30s
    scrapeTimeout: 10s

# Use the PostgreSQL subchart for development/testing
postgresql:
  enabled: false
  auth:
    username: "marmot"
    database: "marmot"
    password: "changeme"
  primary:
    persistence:
      enabled: true
      size: 20Gi
