# Default values for marmot.

replicaCount: 1

image:
  repository: ghcr.io/marmotdata/marmot
  pullPolicy: IfNotPresent
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: marmot.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: marmot-tls
  #    hosts:
  #      - marmot.local

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}
tolerations: []
affinity: {}

# Marmot application configuration
config:
  # Server configuration
  server:
    port: 8080
    host: "0.0.0.0"
    rootUrl: ""
    customResponseHeaders: {}

    # Encryption key for pipeline credentials
    # Option 1: Auto-generate (recommended for new deployments)
    autoGenerateEncryptionKey: true
    # Option 2: Provide key directly (not recommended for production)
    encryptionKey: ""
    # Option 3: Reference existing secret (recommended for production)
    # encryptionKeySecretRef:
    #   name: "marmot-encryption-secret"
    #   key: "encryption-key"

    # Allow running without encryption (NOT RECOMMENDED)
    allowUnencrypted: false

  # Database configuration
  database:
    # When postgresql.enabled is true, these are automatically populated
    host: "postgresql"
    port: 5432
    user: "marmot"
    # Use either password OR passwordSecretRef (not both)
    password: ""
    # passwordSecretRef:
    #   name: "marmot-database-secret"
    #   key: "password"
    name: "marmot"
    sslmode: "disable"
    # Connection pool settings
    maxConns: 100
    idleConns: 20
    connLifetime: 30  # minutes

  # Search configuration
  search:
    timeout: 10  # seconds

  # Logging configuration
  logging:
    level: "info"
    format: "json"

  # Authentication configuration
  auth:
    anonymous:
      enabled: false
      role: "user"

    # OAuth providers (e.g., Okta, Google, GitHub)
    providers: {}
      # okta:
      #   enabled: true
      #   type: "okta"
      #   name: "Okta"
      #   clientId: ""
      #   clientSecret: ""
      #   url: "https://your-org.okta.com"
      #   scopes:
      #     - "openid"
      #     - "profile"
      #     - "email"

  # Metrics configuration
  metrics:
    enabled: false
    port: 9090
    ownerMetadataFields:
      - "owner"
      - "ownedBy"
      - "owningTeam"
    schemas:
      excludedAssetTypes:
        - "Service"
      excludedProviders: []

  # Rate limiting
  rateLimit:
    enabled: false

  # UI configuration
  ui:
    banner:
      enabled: false
      dismissible: true
      variant: "info"  # info, warning, error, success
      message: ""
      id: "banner-1"

  # Pipeline/ingestion configuration
  pipelines:
    maxWorkers: 10
    schedulerInterval: 60   # seconds
    leaseExpiry: 300        # seconds
    claimExpiry: 30         # seconds

  # OpenLineage configuration
  openlineage:
    auth:
      enabled: true

# Prometheus ServiceMonitor
monitoring:
  serviceMonitor:
    enabled: false
    labels: {}
    interval: 30s
    scrapeTimeout: 10s
    path: /metrics
    annotations: {}

# Additional environment variables
env: {}

# Bitnami PostgreSQL subchart
# https://github.com/bitnami/charts/tree/main/bitnami/postgresql
postgresql:
  enabled: false
  auth:
    username: "marmot"
    database: "marmot"
  primary:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi

# CloudNativePG configuration
# Requires the CNPG operator to be installed separately
# https://cloudnative-pg.io/documentation/current/installation_upgrade/
cnpg:
  enabled: false
  # PostgreSQL instances (1 primary + N-1 replicas)
  instances: 3
  image: "ghcr.io/cloudnative-pg/postgresql:16"
  username: "marmot"
  password: ""
  database: "marmot"
  # PostgreSQL parameters
  parameters:
    shared_buffers: "256MB"
    work_mem: "64MB"
    maintenance_work_mem: "128MB"
    effective_cache_size: "1GB"
    max_connections: "200"
  # Storage configuration
  persistence:
    enabled: true
    size: "8Gi"
    # storageClass: ""
  # Resource limits
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"
  # PgBouncer connection pooler
  pooler:
    enabled: true
    instances: 2
    poolMode: "transaction"
    maxClientConn: 1000
    defaultPoolSize: 25
    reservePoolSize: 5
