# Default values for marmot.
# This is a YAML-formatted file.

replicaCount: 1

image:
  repository: ghcr.io/marmotdata/marmot
  pullPolicy: IfNotPresent
  tag: "0.4.1"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 65534

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: marmot.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: marmot-tls
  #    hosts:
  #      - marmot.local

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Marmot application configuration
config:
  # Server configuration
  server:
    port: 8080
    host: "0.0.0.0"
    rootUrl: ""
    customResponseHeaders: {}

    # Encryption key configuration for pipeline credentials
    # Use ONE of the following options:
    # 1. Auto-generate (recommended for new deployments)
    autoGenerateEncryptionKey: true
    # 2. Provide key directly (not recommended for production)
    encryptionKey: ""
    # 3. Reference existing secret (recommended for production)
    # encryptionKeySecretRef:
    #   name: "marmot-encryption-secret"
    #   key: "encryption-key"

    # Allow running without encryption (NOT RECOMMENDED)
    # If true, Marmot will start even without an encryption key
    # Pipeline credentials will be stored in PLAINTEXT in the database
    allowUnencrypted: false

  # Metrics configuration
  metrics:
    enabled: false
    port: 9090
    ownerMetadataFields:
      - "owner"
      - "ownedBy"
      - "owningTeam"
    schemas:
      excludedAssetTypes:
        - "Service"
      excludedProviders: []

  # Database configuration
  database:
    # When postgresql.enabled is true, these values are automatically populated
    host: "postgresql"
    port: 5432
    user: "marmot"
    # Use either password OR passwordSecretRef (not both)
    password: ""
    # passwordSecretRef:
    #   name: "marmot-database-secret"
    #   key: "password"
    name: "marmot"
    sslmode: "disable"
    maxConns: 25
    idleConns: 5
    connLifetime: 5

  # Logging configuration
  logging:
    level: "info"
    format: "json"

  # Authentication configuration
  auth:
    # Anonymous authentication
    anonymous:
      enabled: false
      role: "user"

    # OpenLineage authentication
    openlineage:
      enabled: true

    # OAuth providers (e.g., Okta, Google, etc.)
    providers: {}
      # okta:
      #   enabled: false
      #   type: "okta"
      #   name: "Okta"
      #   clientId: ""
      #   # Use either clientSecret OR clientSecretRef (not both)
      #   clientSecret: ""
      #   # clientSecretRef:
      #   #   name: "okta-secret"
      #   #   key: "client-secret"
      #   url: "https://your-org.okta.com"
      #   redirectUrl: ""
      #   scopes:
      #     - "openid"
      #     - "profile"
      #     - "email"
      #     - "groups"
      #     - "offline_access"
      #   allowSignup: true
      #   groupMapping: []
      #     # - groupName: "admin-group"
      #     #   roles:
      #     #     - "admin"
      #   teamSync:
      #     enabled: false
      #     stripPrefix: ""
      #     group:
      #       claim: "groups"
      #       filter:
      #         mode: ""
      #         pattern: ""

  # Rate limiting configuration
  rateLimit:
    enabled: false

  # UI configuration
  ui:
    banner:
      enabled: false
      dismissible: true
      variant: "info"  # info, warning, error, success
      message: ""
      id: "banner-1"

  # Pipeline/ingestion configuration
  pipelines:
    maxWorkers: 10
    schedulerInterval: 60  # seconds
    leaseExpiry: 300  # seconds
    claimExpiry: 30  # seconds

monitoring:
  serviceMonitor:
    enabled: false
    labels: {}
    interval: 30s
    scrapeTimeout: 10s
    path: /metrics
    annotations: {}

# Additional environment variables
env: {}

# PostgreSQL subchart configuration
postgresql:
  enabled: false
  auth:
    username: "marmot"
    database: "marmot"
    # If not specified, a random password will be generated
    # password: "changeme"
  primary:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
  # See here for additional config: https://github.com/bitnami/charts/tree/main/bitnami/postgresql
