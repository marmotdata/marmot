The DBT plugin ingests metadata from dbt (Data Build Tool) projects, including models, sources, seeds, and lineage relationships. It reads dbt's generated artifacts to understand your data transformation layer and how it connects to your warehouse.

## Prerequisites

### Generate dbt Artifacts

Before Marmot can ingest your dbt project, you need to generate the artifact files. These are created in your project's `target/` directory.

**Required:** Run `dbt compile` or `dbt build` to generate `manifest.json`:

```bash
dbt compile
# or
dbt build
```

**Recommended:** Run `dbt docs generate` to create `catalog.json` with column types and statistics:

```bash
dbt docs generate
```

### Artifact Files

| File               | Required | Generated By                          | Contains                              |
| ------------------ | -------- | ------------------------------------- | ------------------------------------- |
| `manifest.json`    | Yes      | `dbt compile`, `dbt build`, `dbt run` | Models, sources, seeds, lineage, SQL  |
| `catalog.json`     | No       | `dbt docs generate`                   | Column types, table stats, owner info |
| `run_results.json` | No       | `dbt run`, `dbt build`                | Execution status, timing, failures    |

## Configuration

Point the plugin to your dbt project's `target/` directory:

```yaml
target_path: "/path/to/dbt/project/target"
project_name: "analytics"
environment: "production"
tags:
  - "dbt"
  - "analytics"
```

### Configuration Options

| Option                | Default      | Description                                          |
| --------------------- | ------------ | ---------------------------------------------------- |
| `target_path`         | _required_   | Path to dbt `target/` directory containing artifacts |
| `project_name`        | _required_   | Name of your dbt project                             |
| `environment`         | `production` | Environment label (e.g., dev, staging, prod)         |
| `include_manifest`    | `true`       | Read `manifest.json` for model definitions           |
| `include_catalog`     | `true`       | Read `catalog.json` for column/stats info            |
| `include_run_results` | `false`      | Read `run_results.json` for execution status         |
| `discover_models`     | `true`       | Discover dbt models                                  |
| `discover_sources`    | `true`       | Discover dbt sources                                 |

## What Gets Discovered

### Models

Each dbt model creates two assets in Marmot:

1. **Model asset** (type: `Model`, provider: `DBT`) - Represents the transformation logic
   - Contains the compiled SQL query
   - Tracks dbt-specific metadata (package, path, materialization)

2. **Materialized asset** (type: `Table`/`View`, provider: varies) - Represents the output in your warehouse
   - Type determined by materialization (table, view, incremental, etc.)
   - Provider matches your dbt adapter (Snowflake, BigQuery, Postgres, etc.)
   - Contains column schema from catalog

## Supported Adapters

The plugin recognizes your dbt adapter and maps assets to the correct provider:

| Adapter      | Provider Name | Special Materializations      |
| ------------ | ------------- | ----------------------------- |
| `postgres`   | Postgres      | -                             |
| `snowflake`  | Snowflake     | Dynamic Table                 |
| `bigquery`   | BigQuery      | -                             |
| `redshift`   | Redshift      | Materialized View             |
| `databricks` | Databricks    | Streaming Table               |
| `duckdb`     | DuckDB        | -                             |
| `clickhouse` | ClickHouse    | Dictionary, Distributed Table |
| `trino`      | Trino         | -                             |
| `athena`     | Athena        | -                             |
| `spark`      | Spark         | -                             |
